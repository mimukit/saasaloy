---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { BlogHero } from "@repo/ui/blocks/marketing/blog/blog-hero";
import { BlogFeatured } from "@repo/ui/blocks/marketing/blog/blog-featured";
import {
  BlogContent,
  type BlogPost,
} from "@repo/ui/blocks/marketing/blog/blog-content";

const blogPosts = await getCollection("blog");
const sortedPosts = blogPosts.sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime()
);

const serializedPosts: BlogPost[] = sortedPosts.map((post) => ({
  id: post.id,
  title: post.data.title,
  description: post.data.description,
  publishedAt: post.data.publishedAt.toISOString(),
  category: post.data.category,
  tags: post.data.tags,
  featured: post.data.featured,
}));
---

<BaseLayout
  title="Blog | SaasAloy"
  description="Latest blog posts from SaasAloy"
>
  <BlogHero />
  <BlogFeatured posts={serializedPosts} />
  <BlogContent posts={serializedPosts} client:load />
</BaseLayout>
